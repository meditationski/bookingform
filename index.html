<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Your Lesson - Ski School Georgia</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            line-height: 1.5;
        }

        .booking-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .booking-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .booking-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .booking-subtitle {
            font-size: 1.1rem;
            color: #888;
            font-weight: 400;
        }

        .booking-steps {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            gap: 20px;
        }

        .step-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #666;
        }

        .step-indicator.active {
            color: #667eea;
        }

        .step-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .step-indicator.active .step-number {
            background: #667eea;
            color: white;
        }

        .form-section {
            display: none;
            background: #111;
            border-radius: 12px;
            padding: 30px;
            border: 1px solid #222;
        }

        .form-section.active {
            display: block;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 24px;
            color: #fff;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        @media (min-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 8px;
            color: #ccc;
        }

        .form-select, .form-input {
            width: 100%;
            padding: 12px 16px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            color: #fff;
            font-size: 0.95rem;
            font-family: 'Inter', sans-serif;
        }

        .form-select:focus, .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .slider-container {
            margin-top: 8px;
        }

        .slider-value {
            text-align: center;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 12px;
            font-size: 0.95rem;
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            background: #333;
            border-radius: 2px;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #667eea;
            border-radius: 50%;
            cursor: pointer;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
        }

        .calendar {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #333;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-month {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
        }

        .calendar-nav {
            display: flex;
            gap: 8px;
        }

        .calendar-nav button {
            background: #333;
            border: none;
            color: #fff;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            margin-bottom: 12px;
            font-size: 0.8rem;
            color: #666;
            font-weight: 500;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: transparent;
            color: #ccc;
            font-size: 0.85rem;
            border-radius: 6px;
            cursor: pointer;
        }

        .day:hover:not(.disabled):not(.selected) {
            background: #333;
        }

        .day.selected {
            background: #667eea;
            color: white;
        }

        .day.today {
            border: 1px solid #667eea;
        }

        .day.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .day.other-month {
            opacity: 0.3;
        }

        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 8px;
            margin-top: 16px;
        }

        .time-slot {
            padding: 10px 8px;
            background: #333;
            border: none;
            border-radius: 6px;
            color: #ccc;
            font-size: 0.85rem;
            cursor: pointer;
            text-align: center;
        }

        .time-slot.selected {
            background: #667eea;
            color: white;
        }

        .selected-info {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
            text-align: center;
            color: #667eea;
            font-weight: 500;
        }

        .price-summary {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid #333;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 0.95rem;
        }

        .price-total {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
        }

        .price-deposit {
            color: #667eea;
            font-weight: 600;
        }

        .discount-badge {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-top: 12px;
            text-align: center;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s ease;
        }

        .btn-back {
            background: #333;
            color: #fff;
        }

        .btn-next, .btn-book {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-next:disabled {
            background: #333;
            cursor: not-allowed;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-1px);
        }

        .success-screen {
            text-align: center;
            padding: 60px 20px;
        }

        .success-icon {
            font-size: 4rem;
            margin-bottom: 24px;
            color: #10b981;
        }

        .success-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: #fff;
        }

        .success-message {
            font-size: 1.1rem;
            color: #888;
            max-width: 400px;
            margin: 0 auto;
        }

        .error-message {
            color: #ef4444;
            font-size: 0.85rem;
            margin-top: 4px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .iti {
            width: 100%;
        }

        #phone {
            padding-left: 80px !important;
        }
    </style>
</head>
<body>
    <div class="booking-container">
        <div class="booking-header">
            <h1 class="booking-title">Book Your Ski Lesson</h1>
            <p class="booking-subtitle">Professional instructors • Best slopes • Unforgettable experience</p>
        </div>

        <div class="booking-steps">
            <div class="step-indicator active">
                <div class="step-number">1</div>
                <span>Lesson Details</span>
            </div>
            <div class="step-indicator">
                <div class="step-number">2</div>
                <span>Personal Info</span>
            </div>
        </div>

        <!-- Step 1: Lesson Details -->
        <div class="form-section active" id="step1">
            <div class="form-grid">
                <div>
                    <h2 class="section-title">Lesson Information</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Sport Type</label>
                        <select class="form-select" id="sportType">
                            <option value="ski">Ski Lesson</option>
                            <option value="snowboard">Snowboard Lesson</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Lesson Duration</label>
                        <select class="form-select" id="duration">
                            <option value="2">2 hours - $100</option>
                            <option value="3">3 hours - $140</option>
                            <option value="full">Full day - $250</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Number of People</label>
                        <div class="slider-container">
                            <div class="slider-value" id="participantsValue">1 Person</div>
                            <input type="range" id="participants" min="1" max="5" value="1" step="1">
                            <div class="slider-labels">
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Number of Days</label>
                        <div class="slider-container">
                            <div class="slider-value" id="daysValue">1 Day</div>
                            <input type="range" id="days" min="1" max="10" value="1" step="1">
                            <div class="slider-labels">
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                                <span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <h2 class="section-title">Date & Time</h2>
                    
                    <div class="calendar">
                        <div class="calendar-header">
                            <div class="calendar-nav">
                                <button id="prevMonth">‹</button>
                            </div>
                            <div class="calendar-month" id="currentMonth">December 2025</div>
                            <div class="calendar-nav">
                                <button id="nextMonth">›</button>
                            </div>
                        </div>
                        
                        <div class="weekdays">
                            <div>Mon</div><div>Tue</div><div>Wed</div>
                            <div>Thu</div><div>Fri</div><div>Sat</div>
                            <div>Sun</div>
                        </div>
                        
                        <div class="days" id="calendarDays"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Available Times</label>
                        <div class="time-slots" id="timeSlots"></div>
                    </div>

                    <div class="selected-info" id="selectedDateTime">
                        Please select a date and time for your lesson
                    </div>
                </div>
            </div>

            <div class="price-summary">
                <div class="price-row">
                    <span>Total Amount:</span>
                    <span id="totalPrice" class="price-total">$100</span>
                </div>
                <div class="price-row">
                    <span>20% Deposit Required:</span>
                    <span id="depositPrice" class="price-deposit">$20</span>
                </div>
                <div class="price-row">
                    <span>Remaining Balance:</span>
                    <span id="remainingPrice">$80</span>
                </div>
                <div id="discountInfo" class="discount-badge"></div>
            </div>

            <div class="form-actions">
                <div></div>
                <button class="btn btn-next" id="nextToStep2" disabled>Continue to Booking</button>
            </div>
        </div>

        <!-- Step 2: Personal Information -->
        <div class="form-section" id="step2">
            <h2 class="section-title">Personal Information</h2>
            <div class="selected-info" id="step2DateTime" style="margin-bottom: 30px;"></div>

            <form id="personalInfoForm">
                <div class="form-grid">
                    <div>
                        <div class="form-group">
                            <label class="form-label">Full Name *</label>
                            <input type="text" id="fullName" class="form-input" placeholder="Enter your full name" required>
                            <div class="error-message" id="fullNameError">Please enter your full name</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Phone Number (WhatsApp) *</label>
                            <input type="tel" id="phone" class="form-input" placeholder="Your phone number" required>
                            <div class="error-message" id="phoneError">Please enter a valid phone number</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Email Address *</label>
                            <input type="email" id="email" class="form-input" placeholder="your.email@example.com" required>
                            <div class="error-message" id="emailError">Please enter a valid email address</div>
                        </div>
                    </div>

                    <div>
                        <div class="form-group">
                            <label class="form-label">Skill Level *</label>
                            <select id="skillLevel" class="form-select" required>
                                <option value="">Select your level</option>
                                <option value="first-time">First Time</option>
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                            </select>
                            <div class="error-message" id="skillLevelError">Please select your skill level</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Additional Information</label>
                            <textarea id="additionalInfo" class="form-input" rows="4" placeholder="Any special requests or requirements..."></textarea>
                        </div>

                        <div class="price-summary">
                            <div class="price-row">
                                <span>Total Amount:</span>
                                <span id="totalPriceStep2" class="price-total">$100</span>
                            </div>
                            <div class="price-row">
                                <span>Deposit to Pay:</span>
                                <span id="depositPriceStep2" class="price-deposit">$20</span>
                            </div>
                            <div id="discountInfoStep2" class="discount-badge"></div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-back" id="backToStep1">Back</button>
                    <button type="submit" class="btn btn-book" id="bookButton">
                        Complete Booking - Pay $<span id="depositAmount">20</span> Deposit
                    </button>
                </div>
            </form>
        </div>

        <!-- Success Screen -->
        <div class="form-section" id="successScreen">
            <div class="success-screen">
                <div class="success-icon">✅</div>
                <h1 class="success-title">Booking Confirmed!</h1>
                <p class="success-message">
                    Thank you for booking with Ski School Georgia! We've sent a confirmation email 
                    with all the details. Our instructor will contact you shortly via WhatsApp.
                </p>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        // Configuration
        const CONFIG = {
            prices: {2: 100, 3: 140, full: 250},
            minDate: new Date(2025, 11, 15),
            maxDate: new Date(2026, 3, 30),
            resortCloseHour: 17,
            lessonStartHour: 10
        };

        // State
        const State = {
            currentMonth: new Date(Math.max(new Date(), CONFIG.minDate)),
            selectedDate: null,
            selectedTime: null,
            currentStep: 1,
            
            init() {
                this.currentMonth.setDate(1);
            },
            
            getBookingTitle() {
                const sport = document.getElementById('sportType').value;
                const duration = document.getElementById('duration').value;
                const people = document.getElementById('participants').value;
                const days = document.getElementById('days').value;
                
                const durationText = {2: '2 Hours', 3: '3 Hours', full: 'Full Day'}[duration];
                const sportText = sport === 'ski' ? 'Ski' : 'Snowboard';
                const peopleText = people > 1 ? ` for ${people} People` : '';
                const daysText = days > 1 ? ` x ${days} Days` : '';
                
                return `${durationText} ${sportText} Lesson${peopleText}${daysText}`;
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            State.init();
            initPhone();
            setupEvents();
            renderCalendar();
            updatePrices();
        });

        function initPhone() {
            window.phoneInput = window.intlTelInput(document.getElementById('phone'), {
                initialCountry: "ge",
                preferredCountries: ['ge', 'ru', 'us', 'gb'],
                utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"
            });
        }

        function setupEvents() {
            // Form elements
            ['sportType', 'duration', 'participants', 'days'].forEach(id => {
                document.getElementById(id).addEventListener('input', updatePrices);
            });

            // Navigation
            document.getElementById('nextToStep2').addEventListener('click', () => showStep(2));
            document.getElementById('backToStep1').addEventListener('click', () => showStep(1));

            // Calendar
            document.getElementById('prevMonth').addEventListener('click', () => navigateMonth(-1));
            document.getElementById('nextMonth').addEventListener('click', () => navigateMonth(1));

            // Form submission
            document.getElementById('personalInfoForm').addEventListener('submit', handleSubmit);
        }

        function showStep(step) {
            document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
            document.getElementById(`step${step}`).classList.add('active');
            
            // Update step indicators
            document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
                indicator.classList.toggle('active', index < step);
            });
            
            State.currentStep = step;
            
            if (step === 2) {
                document.getElementById('step2DateTime').textContent = document.getElementById('selectedDateTime').textContent;
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updatePrices() {
            const data = calculatePrice();
            
            // Update participant and day displays
            const people = document.getElementById('participants').value;
            const days = document.getElementById('days').value;
            document.getElementById('participantsValue').textContent = people + ' Person' + (people > 1 ? 's' : '');
            document.getElementById('daysValue').textContent = days + ' Day' + (days > 1 ? 's' : '');
            
            // Update prices
            ['', 'Step2'].forEach(suffix => {
                document.getElementById(`totalPrice${suffix}`).textContent = `$${data.total}`;
                document.getElementById(`depositPrice${suffix}`).textContent = `$${data.deposit}`;
                document.getElementById(`remainingPrice${suffix}`).textContent = `$${data.remaining}`;
                document.getElementById(`discountInfo${suffix}`).textContent = data.discountText;
            });
            
            document.getElementById('depositAmount').textContent = data.deposit;
        }

        function calculatePrice() {
            const duration = document.getElementById('duration').value;
            const people = parseInt(document.getElementById('participants').value);
            const days = parseInt(document.getElementById('days').value);
            
            const basePrice = CONFIG.prices[duration];
            const pricePerDay = basePrice + (people - 1) * 40;
            
            let total = 0;
            let maxDiscount = 0;
            
            for (let day = 1; day <= days; day++) {
                const discount = day >= 8 ? 0.20 : day >= 6 ? 0.15 : day >= 4 ? 0.10 : 0;
                total += pricePerDay * (1 - discount);
                if (discount > maxDiscount) maxDiscount = discount;
            }
            
            total = Math.round(total);
            const deposit = Math.round(total * 0.20);
            const remaining = total - deposit;
            
            const discountText = maxDiscount > 0 ? 
                `🎉 You save ${maxDiscount * 100}% on days ${maxDiscount === 0.20 ? '8+' : maxDiscount === 0.15 ? '6-7' : '4-5'}` : '';
            
            return { total, deposit, remaining, discountText };
        }

        function renderCalendar() {
            const year = State.currentMonth.getFullYear();
            const month = State.currentMonth.getMonth();
            
            document.getElementById('currentMonth').textContent = 
                State.currentMonth.toLocaleDateString('en-US', {month: 'long', year: 'numeric'});
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;
            
            document.getElementById('calendarDays').innerHTML = '';
            
            // Previous month
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = startDay - 1; i >= 0; i--) {
                createDay(prevMonthLastDay - i, 'day other-month disabled', true);
            }
            
            // Current month
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(year, month, day);
                let className = 'day';
                
                if (date.toDateString() === today.toDateString()) className += ' today';
                
                if (date < CONFIG.minDate || date > CONFIG.maxDate || date < today) {
                    createDay(day, className + ' disabled', true);
                } else {
                    if (State.selectedDate && State.selectedDate.toDateString() === date.toDateString()) {
                        className += ' selected';
                    }
                    createDay(day, className, false, date);
                }
            }
            
            // Next month
            const totalCells = 42;
            const nextMonthDays = totalCells - (startDay + lastDay.getDate());
            for (let day = 1; day <= nextMonthDays; day++) {
                createDay(day, 'day other-month disabled', true);
            }
            
            updateTimeSlots();
        }

        function createDay(day, className, disabled, date = null) {
            const button = document.createElement('button');
            button.className = className;
            button.textContent = day;
            button.disabled = disabled;
            
            if (!disabled && date) {
                button.addEventListener('click', () => {
                    State.selectedDate = date;
                    renderCalendar();
                    updateTimeSlots();
                    updateSelectedDateTime();
                    document.getElementById('nextToStep2').disabled = !State.selectedTime;
                    
                    setTimeout(() => {
                        document.getElementById('timeSlots').scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'center' 
                        });
                    }, 300);
                });
            }
            
            document.getElementById('calendarDays').appendChild(button);
        }

        function navigateMonth(direction) {
            State.currentMonth.setMonth(State.currentMonth.getMonth() + direction);
            renderCalendar();
        }

        function updateTimeSlots() {
            document.getElementById('timeSlots').innerHTML = '';
            
            if (!State.selectedDate) {
                document.getElementById('timeSlots').innerHTML = '<div class="time-slot disabled">Select date first</div>';
                document.getElementById('nextToStep2').disabled = true;
                return;
            }

            const duration = document.getElementById('duration').value;
            
            if (duration === 'full') {
                createTimeSlot('10:00', '10:00 (Full day)');
            } else {
                const hours = parseInt(duration);
                for (let hour = CONFIG.lessonStartHour; hour <= CONFIG.resortCloseHour - hours; hour++) {
                    createTimeSlot(`${hour}:00`);
                }
            }
        }

        function createTimeSlot(time, display = null) {
            const slot = document.createElement('button');
            slot.className = 'time-slot';
            slot.textContent = display || time;
            
            if (State.selectedTime === time) slot.classList.add('selected');
            
            slot.addEventListener('click', function() {
                document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
                State.selectedTime = time;
                this.classList.add('selected');
                updateSelectedDateTime();
                document.getElementById('nextToStep2').disabled = false;
            });
            
            document.getElementById('timeSlots').appendChild(slot);
        }

        function updateSelectedDateTime() {
            if (State.selectedDate && State.selectedTime) {
                const dateStr = State.selectedDate.toLocaleDateString('en-US', {
                    weekday: 'long', month: 'long', day: 'numeric', year: 'numeric'
                });
                document.getElementById('selectedDateTime').textContent = `${dateStr} at ${State.selectedTime}`;
            }
        }

        function handleSubmit(e) {
            e.preventDefault();
            if (!validateForm()) return;
            
            const data = getFormData();
            sendEmail(data);
            showSuccess();
        }

        function validateForm() {
            let valid = true;
            
            if (!document.getElementById('fullName').value.trim()) {
                showError('fullNameError', 'Please enter your full name');
                valid = false;
            } else hideError('fullNameError');
            
            if (!window.phoneInput.isValidNumber()) {
                showError('phoneError', 'Please enter a valid phone number');
                valid = false;
            } else hideError('phoneError');
            
            if (!document.getElementById('email').value.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
                showError('emailError', 'Please enter a valid email address');
                valid = false;
            } else hideError('emailError');
            
            if (!document.getElementById('skillLevel').value) {
                showError('skillLevelError', 'Please select your skill level');
                valid = false;
            } else hideError('skillLevelError');
            
            return valid;
        }

        function showError(id, msg) {
            const el = document.getElementById(id);
            el.textContent = msg;
            el.classList.add('show');
        }

        function hideError(id) {
            document.getElementById(id).classList.remove('show');
        }

        function getFormData() {
            const duration = document.getElementById('duration').value;
            const people = document.getElementById('participants').value;
            const days = document.getElementById('days').value;
            const sport = document.getElementById('sportType').value;
            
            const durationText = {2: '2 Hours', 3: '3 Hours', full: 'Full Day'}[duration];
            const sportText = sport === 'ski' ? 'Ski' : 'Snowboard';
            const peopleText = people + ' Person' + (people > 1 ? 's' : '');
            
            const price = calculatePrice();
            
            return {
                subject: `Ski School Booking: ${durationText} ${sportText} Lesson`,
                durationText,
                sportText,
                peopleText,
                days,
                dateTime: document.getElementById('selectedDateTime').textContent,
                fullName: document.getElementById('fullName').value,
                phone: window.phoneInput.getNumber(),
                email: document.getElementById('email').value,
                skillLevel: document.getElementById('skillLevel').options[document.getElementById('skillLevel').selectedIndex].text,
                additionalInfo: document.getElementById('additionalInfo').value,
                total: price.total,
                deposit: price.deposit,
                remaining: price.remaining
            };
        }

        function sendEmail(data) {
            const body = `
${data.durationText} ${data.sportText} Lesson with ${data.peopleText} x ${data.days} days
${data.dateTime}

Full Name: ${data.fullName}
Phone (WhatsApp): https://wa.me/${data.phone.replace('+', '')}
Email: ${data.email}
Skill level: ${data.skillLevel}
Additional information: ${data.additionalInfo || 'None'}

Total amount: $${data.total}
20% deposit: $${data.deposit}
Remaining balance: $${data.remaining}

Google Calendar Link: ${generateCalendarLink(data)}
            `.trim();

            emailjs.init('gb9ZTULk6-ghDtZuV');
            emailjs.send('service_0tuoznd', 'template_jiiwo1f', {
                to_email: 'info@skischool.ge',
                subject: data.subject,
                message: body,
                from_name: data.fullName,
                from_email: data.email,
                phone: data.phone
            }).then(() => {
                console.log('Email sent successfully');
            }, () => {
                const mailto = `mailto:info@skischool.ge?subject=${encodeURIComponent(data.subject)}&body=${encodeURIComponent(body)}`;
                window.open(mailto, '_blank');
            });
        }

        function generateCalendarLink(data) {
            const start = new Date(State.selectedDate);
            const [hours] = State.selectedTime.split(':');
            start.setHours(parseInt(hours), 0, 0);
            
            const end = new Date(start);
            const duration = document.getElementById('duration').value;
            const days = parseInt(document.getElementById('days').value);
            
            end.setHours(start.getHours() + (duration === 'full' ? 8 : parseInt(duration)));
            
            const details = `
${data.durationText} ${data.sportText} Lesson
Participants: ${data.peopleText}
Duration: ${data.days} days

Contact Info:
Name: ${data.fullName}
Phone: ${data.phone}
Email: ${data.email}
Skill Level: ${data.skillLevel}

Payment:
Total: $${data.total}
Deposit: $${data.deposit}
Balance: $${data.remaining}
            `.trim();

            const params = new URLSearchParams({
                action: 'TEMPLATE',
                text: `Ski Lesson: ${data.fullName}`,
                dates: `${formatDate(start)}/${formatDate(end)}`,
                details: details,
                location: 'Gudauri Ski Resort, Georgia'
            });

            if (days > 1) {
                params.append('recur', `RRULE:FREQ=DAILY;COUNT=${days}`);
            }

            return `https://calendar.google.com/calendar/render?${params}`;
        }

        function formatDate(date) {
            return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
        }

        function showSuccess() {
            showStep(3);
            document.getElementById('successScreen').classList.add('active');
        }
    </script>
</body>
</html>
